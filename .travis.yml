language: c

sudo: required

dist: xenial

env:
  global:
    - ARCH="amd64"
    - COVERAGE="true"
    - secure: "qhgUldrBzVBuE5QQBtkgNmlZjIxPSiWX0MS2zth1hQPzQw0zr50+tBE5/tetBXsWkBwOJi5IEWgs5LWdDLe/yhQ3oFeCqfn2fVa6ZSWLxmHgBC5VX1tZQ8mCmVYc781t131mYcbpCJaAi2/X21aqPB9y29Xj2MoMNlJSgv7Xffo="
  matrix:
    - MYCC="gcc-4.9"
    - MYCC="gcc-5"
    - MYCC="gcc-6"
    - MYCC="gcc-7"
    - MYCC="gcc-8"
    - MYCC="gcc-9"
    - MYCC="gcc-4.8"
      ARCH="i386"
      CFLAGS="-m32"
      COVERAGE="false"
    - MYCC="clang-3.8"
      COVERAGE="false"

matrix:
  include:
    - language: nix
      before_install: nix-env -iA cachix -f https://github.com/NixOS/nixpkgs/tarball/889c72032f8595fcd7542c6032c208f6b8033db6
      install:
      before_script:
      script: nix-build --argstr handlebarscVersion $TRAVIS_BRANCH | tee result.txt
      after_success: cat result.txt | cachix push jbboehr-ci
      after_failure:
      env:
        - MYCC=

cache: false

branches:
  only:
    - master
    - travis

before_install: travis_retry sudo ./.travis.sh before_install
install: travis_retry sudo ./.travis.sh install
before_script: sudo ./.travis.sh before_script
script: sudo ./.travis.sh script
after_success: travis_retry sudo ./.travis.sh after_success
after_failure: travis_retry sudo ./.travis.sh after_failure

